<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${product.productName} + ' - Product Details'">Alkaline Water (Pure) - Product Details</title>
    <style>
        #auto-format-description strong {
            display: inline-block;
            min-width: 28px;
            font-weight: bold;
        }

        #auto-format-description br + strong {
            margin-top: 1rem;
            display: inline-block;
        }

        /* Hoặc dùng block để xuống dòng rõ ràng */
        #auto-format-description .icon-block {
            display: block;
            margin-top: 1rem;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>

    <th:block th:replace="~{header :: head}"></th:block>
</head>
<body>
<!-- Include SVG Icons -->
<th:block th:replace="~{header :: svg-icons}"></th:block>
<th:block th:replace="~{header :: offcanvas-cart}"></th:block>

<!-- Preloader -->
<div class="preloader-wrapper">
    <div class="preloader"></div>
</div>

<!-- Offcanvas Cart -->
<!--<div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasCart">-->
<!--    <div class="offcanvas-header justify-content-center">-->
<!--        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>-->
<!--    </div>-->
<!--    <div class="offcanvas-body">-->
<!--        <h4 class="d-flex justify-content-between align-items-center mb-3">-->
<!--            <span class="text-primary">Your cart</span>-->
<!--            <span class="badge bg-primary rounded-pill">3</span>-->
<!--        </h4>-->
<!--        <ul class="list-group mb-3">-->
<!--            <li class="list-group-item d-flex justify-content-between lh-sm">-->
<!--                <div>-->
<!--                    <h6 class="my-0">Growers cider</h6>-->
<!--                    <small class="text-body-secondary">Brief description</small>-->
<!--                </div>-->
<!--                <span class="text-body-secondary">$12</span>-->
<!--            </li>-->
<!--        </ul>-->
<!--        <button class="w-100 btn btn-primary btn-lg" type="submit">Continue to checkout</button>-->
<!--    </div>-->
<!--</div>-->

<!-- Include Header -->
<th:block th:replace="~{header :: header}"></th:block>

<!-- Main Content -->
<main class="flex flex-col items-start self-stretch pt-20 bg-white -mt-[100px]">
    <div class="flex flex-col items-start self-stretch px-0 py-10 bg-white min-h-[600px]">
        <div class="flex flex-col gap-10 items-center self-stretch">
            <div class="flex flex-wrap justify-center items-start w-full max-w-[1440px]">
                <div class="flex flex-col items-start self-stretch flex-[1_0_0] max-w-[1440px] min-h-px">
                    <div class="flex flex-wrap justify-center items-start self-stretch">
                        <!-- Product Gallery Section -->
                        <section
                                class="flex flex-col items-start self-stretch py-0 pr-4 pl-2.5 flex-[1_0_0] max-w-[720px] min-h-px">
                            <div class="flex justify-center items-start self-stretch">
                                <div class="flex flex-col items-start self-stretch flex-[1_0_0] max-w-[690px]">
                                    <div class="flex flex-col items-start self-stretch">
                                        <!-- Product Gallery -->
                                        <section class="flex relative justify-center items-start w-full max-w-[700px]">
                                            <div class="flex flex-col items-start self-stretch px-1.5 py-0 flex-[1_0_0] max-w-[700px]">
                                                <figure class="flex relative flex-col items-start self-stretch">
                                                    <a th:href="@{${product.mainImageUrl}}" class="flex items-start">
                                                        <img th:src="${product.mainImageUrl}"
                                                             th:alt="${product.productName}"
                                                             class="w-full h-auto max-w-[690px]"/>
                                                    </a>
                                                </figure>
                                            </div>
                                            <!-- Zoom/Expand Button -->
                                            <button class="flex absolute top-0 flex-col items-start p-4 right-[5px]"
                                                    aria-label="Expand image">
                                                <div class="flex justify-center items-center bg-white shadow-sm h-[50px] min-w-[50px] rounded-[30px] hover:shadow-md transition-shadow">
                                                    <div class="flex justify-center items-center px-0 pt-4 pb-4 h-[50px] w-[50px]">
                                                        <svg style="width: 18.5px; height: 18px; flex-shrink: 0;"
                                                             width="19" height="18" viewBox="0 0 19 18" fill="none"
                                                             xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M2.5 2.25V7.3125H3.90625V4.6582L13.5918 14.3438H10.9375V15.75H16V10.6875H14.5938V13.3418L4.9082 3.65625H7.5625V2.25H2.5ZM2.5 15.75H7.5625V14.3438H4.9082L7.77344 11.4609L6.78906 10.4766L3.90625 13.3418V10.6875H2.5V15.75ZM10.7266 6.53906L11.7109 7.52344L14.5938 4.6582V7.3125H16V2.25H10.9375V3.65625H13.5918L10.7266 6.53906Z"
                                                                  fill="#666666"/>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </button>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Product Information Section -->
                        <section
                                class="flex flex-col items-start self-stretch px-4 py-0 flex-[1_0_0] max-w-[720px] min-h-px">
                            <div class="self-stretch h-auto">
                                <!-- Breadcrumb Navigation -->
                                <div class="flex gap-2.5 justify-end items-center mb-5 w-full">
                                    <div class="flex flex-col items-start flex-[1_0_0]">
                                        <nav class="flex flex-wrap content-center items-center" aria-label="Breadcrumb">
                                            <div class="flex flex-col items-start pr-1.5">
                                                <div class="flex gap-1.5 items-start">
                                                    <a th:href="@{/}"
                                                       class="text-sm leading-5 text-neutral-500 hover:text-zinc-800">Home</a>
                                                    <span class="text-sm leading-5 text-neutral-500">/</span>
                                                </div>
                                            </div>
                                            <!--                                            <div class="flex flex-col items-start pr-1.5">-->
                                            <!--                                                <div class="flex gap-1.5 items-start">-->
                                            <!--                                                    <a th:href="@{'/category/' + ${product.category.slug}}" class="text-sm leading-5 text-neutral-500 hover:text-zinc-800"-->
                                            <!--                                                       th:text="${product.category.name}">Baking Aid</a>-->
                                            <!--                                                    <span class="text-sm leading-5 text-neutral-500">/</span>-->
                                            <!--                                                </div>-->
                                            <!--                                            </div>-->
                                            <div class="flex flex-col items-start">
                                                <span class="text-sm font-bold leading-5 text-zinc-800"
                                                      th:text="${product.productName}">Alkaline Water (Pure)</span>
                                            </div>
                                        </nav>
                                    </div>
                                </div>

                                <!-- Product Title -->
                                <header class="flex flex-col items-start pb-0 mb-5 w-full">
                                    <h1 class="text-4xl leading-10 text-zinc-800" th:text="${product.productName}">
                                        Alkaline Water (Pure)</h1>
                                </header>

                                <!-- Price -->
                                <div class="flex flex-col items-start mb-5 w-full"
                                     th:if="${product.sizes != null and !product.sizes.isEmpty()}">
                                    <p class="text-2xl leading-7 text-amber-500 max-h-[26px]">
                                        <span class="font-bold"
                                              th:text="${#numbers.formatDecimal(product.sizes[0].effectivePrice, 0, 'COMMA', 2, 'POINT')} + ' RM'">RM4.56</span>
                                        <span th:if="${product.sizes[0].isPromotionActive}">
                                                – <span class="font-bold line-through text-neutral-400"
                                                        th:text="${#numbers.formatDecimal(product.sizes[0].regularPrice, 0, 'COMMA', 2, 'POINT')} + ' RM'">RM10.41</span>
                                            </span>
                                    </p>
                                </div>

                                <!-- Product Form -->
                                <form class="flex flex-col justify-center items-start pt-px mb-5 w-full">
                                    <!-- Size Selection -->
                                    <div class="flex flex-col justify-center items-start self-stretch pb-5 h-[62px]"
                                         th:if="${product.sizes != null and !product.sizes.isEmpty()}">
                                        <div class="flex flex-col shrink-0 items-start self-stretch h-[42px]">
                                            <div class="flex gap-5 justify-start items-start self-stretch">
                                                <div class="flex flex-col items-start px-0 pt-2 pb-2.5">
                                                    <label class="flex gap-0.5 items-start">
                                                        <span class="text-sm font-bold leading-6 text-zinc-800">Size</span>
                                                        <span class="text-sm font-bold leading-6 text-zinc-800">:</span>
                                                    </label>
                                                </div>
                                                <div class="relative border-2 border-solid border-black border-opacity-10 h-[42px] w-[260px]">
                                                    <select id="sizeSelect"
                                                            class="absolute inset-0 w-full h-full px-4 text-sm leading-5 text-neutral-500 bg-transparent appearance-none cursor-pointer"
                                                            onchange="changeSize(this)">
                                                        <option value="">Choose an option</option>
                                                        <option th:each="size : ${product.sizes}"
                                                                th:value="${size.priceId}"
                                                                th:text="${size.size}"
                                                                th:data-sku="${size.sku}"
                                                                th:data-effective="${size.effectivePrice}"
                                                                th:data-regular="${size.regularPrice}"
                                                                th:data-promotion="${size.isPromotionActive}"
                                                                th:data-discount="${size.discountPercentage}">250G
                                                        </option>
                                                    </select>
                                                    <div class="flex absolute top-0 right-0 flex-col shrink-0 justify-center items-end p-3 h-[42px] w-[260px] pointer-events-none">
                                                        <svg style="width: 18px; height: 18px; flex-shrink: 0; opacity: 1;"
                                                             width="18" height="18" viewBox="0 0 18 18" fill="none"
                                                             xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M4.32001 6.47998L8.64001 10.8L12.96 6.47998"
                                                                  stroke="#BBBBBB" stroke-width="1.44"/>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Quantity and Add to Cart -->
                                    <div class="flex flex-col items-start self-stretch h-[42px]">
                                        <div class="flex flex-wrap gap-2.5 content-start items-start self-stretch">
                                            <!-- Quantity Controls -->
                                            <div class="flex relative justify-center items-start">
                                                <button type="button" onclick="decreaseQuantity()"
                                                        class="flex flex-col items-center pt-3 pr-2.5 pb-3.5 pl-2.5 bg-white border-2 border-solid border-black border-opacity-10 h-[42px] min-w-[25px] hover:bg-gray-50">
                                                    <span class="text-sm font-bold leading-4 text-center uppercase text-neutral-500">-</span>
                                                </button>
                                                <input type="number" value="1" min="1" id="quantity"
                                                       class="flex flex-col items-start px-0 py-3 border-solid border-y-2 border-y-black border-y-opacity-10 h-[42px] max-w-20 w-[30px] text-center text-sm text-neutral-500"/>
                                                <button type="button" onclick="increaseQuantity()"
                                                        class="flex flex-col items-center pt-3 pr-2 pb-3.5 pl-2 bg-white border-2 border-solid border-black border-opacity-10 h-[42px] min-w-[25px] hover:bg-gray-50">
                                                    <span class="text-sm font-bold leading-4 text-center uppercase text-neutral-500">+</span>
                                                </button>
                                            </div>
                                            <!-- Add to Cart Button -->
                                            <button type="button" onclick="addToCart()"
                                                    class="flex justify-center items-center px-5 pt-3 pb-3.5 ml-5 bg-neutral-700 min-h-[42px] rounded-[35px] hover:bg-neutral-600 transition-colors">
                                                <span class="text-sm font-bold leading-4 text-center text-white uppercase">Add to cart</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>

                                <!-- Add to Wishlist -->
                                <div class="inline-flex items-start pt-px mb-5">
                                    <button onclick="addToWishlist()"
                                            class="flex gap-1.5 justify-center items-center self-stretch hover:text-zinc-600 transition-colors">
                                        <div class="flex flex-col items-start pr-1.5 w-5 h-[15px]">
                                            <div class="flex flex-col shrink-0 items-start h-[15px] w-[15px]">
                                                <svg style="width: 15.39px; height: 15px; flex-shrink: 0;" width="16"
                                                     height="15" viewBox="0 0 16 15" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M1.44012 7.51465L7.34344 14.0625H8.04657L13.9499 7.51465C14.2819 7.15332 14.5309 6.74805 14.697 6.29883C14.863 5.84961 14.9509 5.39062 14.9606 4.92188C14.9606 4.51172 14.8996 4.10645 14.7775 3.70605C14.6555 3.30566 14.4675 2.92969 14.2136 2.57812C13.8229 2.03125 13.3395 1.61865 12.7634 1.34033C12.1872 1.06201 11.5915 0.927734 10.9763 0.9375C10.5368 0.947266 10.1047 1.02539 9.67987 1.17188C9.25507 1.31836 8.862 1.54297 8.50067 1.8457C8.42255 1.91406 8.34686 1.98242 8.27362 2.05078C8.20038 2.11914 8.12958 2.19238 8.06122 2.27051L7.69501 2.69531L7.3288 2.27051C7.26044 2.19238 7.18964 2.11914 7.11639 2.05078C7.04315 1.98242 6.96747 1.91406 6.88934 1.8457C6.52802 1.54297 6.13495 1.31836 5.71014 1.17188C5.28534 1.02539 4.85321 0.947266 4.41376 0.9375C3.79852 0.927734 3.20282 1.06201 2.62665 1.34033C2.05048 1.61865 1.56708 2.03125 1.17645 2.57812C0.922546 2.92969 0.734558 3.30566 0.612488 3.70605C0.490417 4.10645 0.429382 4.51172 0.429382 4.92188C0.439148 5.39062 0.527039 5.84961 0.693054 6.29883C0.85907 6.74805 1.10809 7.15332 1.44012 7.51465ZM7.02118 3.70605H8.36884L8.94012 3.04688C9.21356 2.74414 9.5285 2.51465 9.88495 2.3584C10.2414 2.20215 10.6052 2.11914 10.9763 2.10938C11.4059 2.09961 11.8259 2.19238 12.236 2.3877C12.6462 2.58301 12.988 2.87109 13.2614 3.25195C13.447 3.50586 13.5812 3.77441 13.6642 4.05762C13.7473 4.34082 13.7888 4.62891 13.7888 4.92188C13.7888 5.24414 13.7277 5.56396 13.6057 5.88135C13.4836 6.19873 13.3054 6.48438 13.071 6.73828L7.69501 12.7002L2.31903 6.73828C2.08466 6.48438 1.90643 6.19873 1.78436 5.88135C1.66229 5.56396 1.60126 5.24414 1.60126 4.92188C1.60126 4.62891 1.64276 4.34082 1.72577 4.05762C1.80878 3.77441 1.94305 3.50586 2.1286 3.25195C2.40204 2.87109 2.74384 2.58301 3.15399 2.3877C3.56415 2.19238 3.98407 2.09961 4.41376 2.10938C4.78485 2.11914 5.14862 2.20215 5.50507 2.3584C5.86151 2.51465 6.17645 2.74414 6.44989 3.04688L7.02118 3.70605Z"
                                                          fill="#333333"/>
                                                </svg>
                                            </div>
                                        </div>
                                        <span class="text-sm font-bold leading-4 text-zinc-800">Add to wishlist</span>
                                    </button>
                                </div>

                                <!-- Product Meta Information -->
                                <div class="flex flex-col gap-2.5 items-start pt-5 mb-5 w-full border-t border-solid border-t-opacity-10">
                                    <div class="flex flex-col items-start self-stretch">
                                        <p class="self-stretch text-sm leading-6 text-neutral-500">
                                            <span class="font-bold text-zinc-800">SKU:</span>
                                            <span id="product-sku" th:text="${product.sizes[0].sku}">N/A</span>
                                        </p>
                                    </div>
                                    <!--                                    <div class="flex items-start self-stretch">-->
                                    <!--                                        <span class="text-sm font-bold leading-6 text-zinc-800">Category:</span>-->
                                    <!--                                        <a th:href="@{'/category/' + ${product.category.slug}}"-->
                                    <!--                                           class="text-sm leading-6 text-neutral-500 hover:text-zinc-800 ml-1"-->
                                    <!--                                           th:text="${product.category.name}">Baking Aid</a>-->
                                    <!--                                    </div>-->
                                </div>

                                <!-- Social Share -->
                                <div class="shrink-0 w-full h-[26px]">
                                    <span class="float-left shrink-0 text-sm font-bold leading-6 h-[23px] text-zinc-800 w-[45px]">Share:</span>
                                    <div class="inline-flex justify-center items-start p-1.5 ml-1 rounded-xl hover:bg-gray-100">
                                        <a href="#" aria-label="Share on Facebook">
                                            <svg width="9" height="14" viewBox="0 0 9 14" fill="none"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <path d="M7.62891 7.875L8.02539 5.3457H5.5918V3.69141C5.5918 3.34505 5.69434 3.0306 5.89941 2.74805C6.10449 2.4655 6.47591 2.32422 7.01367 2.32422H8.12109V0.177734C8.12109 0.177734 7.91374 0.148112 7.49902 0.0888672C7.08431 0.0296221 6.63997 0 6.16602 0C5.66471 0 5.20898 0.072917 4.79883 0.21875C4.38867 0.373698 4.04004 0.594727 3.75293 0.881836C3.46582 1.16895 3.24479 1.52669 3.08984 1.95508C2.9349 2.37435 2.85742 2.85742 2.85742 3.4043V5.3457H0.628906V7.875H2.85742V14H5.5918V7.875H7.62891Z"
                                                      fill="black" fill-opacity="0.6"/>
                                            </svg>
                                        </a>
                                    </div>
                                    <!-- Thêm các mạng xã hội khác tương tự -->
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Product Description Tabs Section -->
            <section class="flex flex-col items-start self-stretch px-60 pt-0 pb-10 bg-white">
                <div class="flex flex-wrap justify-center items-start self-stretch min-h-[975px]">
                    <div class="flex flex-col items-start self-stretch px-4 py-0 flex-[1_0_0] max-w-[1440px] min-h-px">
                        <div class="flex flex-col gap-7 items-start self-stretch">
                            <div class="flex flex-col items-center self-stretch">
                                <!-- Tab Navigation -->
                                <nav class="flex flex-wrap justify-center content-center items-center" role="tablist">
                                    <div class="flex flex-col items-start pr-8">
                                        <button class="tab-btn active flex relative items-center px-0 pt-8 pb-2.5"
                                                onclick="showTab('description')" role="tab" aria-selected="true">
                                            <span class="relative text-base leading-5 uppercase text-zinc-800">Description</span>
                                            <div class="active-bar absolute bg-amber-500 bottom-[-30px] h-[3px] w-[106px]"></div>
                                        </button>
                                    </div>
                                    <div class="flex flex-col items-start pr-8">
                                        <button class="tab-btn flex items-center px-0 pt-8 pb-2.5"
                                                onclick="showTab('additional')" role="tab">
                                            <span class="text-base leading-5 uppercase text-zinc-800 text-opacity-70">Additional information</span>
                                        </button>
                                    </div>
                                    <div class="flex flex-col items-start">
                                        <button class="tab-btn flex items-center px-0 pt-8 pb-2.5"
                                                onclick="showTab('shipping')" role="tab">
                                            <span class="text-base leading-5 uppercase text-zinc-800 text-opacity-70">Shipping &amp; Delivery</span>
                                        </button>
                                    </div>
                                </nav>

                                <!-- Tab Content -->
                                <article class="tab-content w-full" id="description-panel">
                                    <div id="auto-format-description"
                                         class="prose max-w-none text-sm leading-6 text-neutral-500 space-y-3"
                                         th:utext="${product.description}">
                                        <!-- Nội dung sẽ được xử lý bằng JS -->
                                    </div>
                                </article>
                                <article class="tab-content w-full hidden" id="additional-info-panel">
                                    <p>Additional info goes here...</p>
                                </article>
                                <article class="tab-content w-full hidden" id="shipping-panel">
                                    <p>Shipping info...</p>
                                </article>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Related Products Section -->
                <section class="flex flex-col gap-1.5 items-end mx-auto my-0 w-full max-w-[1410px]">
                    <header class="flex items-center self-stretch">
                        <div class="flex flex-col items-start pb-0">
                            <h2 class="text-2xl leading-8 text-zinc-800">You May Also Like</h2>
                        </div>
                    </header>

                    <div class="flex flex-col items-start w-full">
                        <div class="flex flex-col items-start px-0 pt-4 pb-3 w-full">
                            <div class="flex overflow-x-auto justify-center items-start w-full">
                                <div class="flex gap-5 justify-start items-start min-w-full"
                                     id="related-products-container">
                                    <!-- Loading state -->
                                    <div class="flex justify-center items-center w-full py-10" id="loading-state">
                                        <div class="text-neutral-400">Loading related products...</div>
                                    </div>

                                    <!-- Products will be dynamically loaded here -->
                                </div>
                            </div>

                            <!-- Pagination Dots -->
                            <div class="flex flex-col items-center self-stretch min-h-2.5" id="pagination-dots"
                                 style="display: none;">
                                <nav class="flex gap-2.5 items-center" aria-label="Product carousel pagination">
                                    <!-- Pagination will be dynamically generated -->
                                </nav>
                            </div>
                        </div>
                    </div>
                </section>

                <script>
                    // Get current product ID from URL or data attribute
                    const currentProductId = [[${product.productId}]];

                    // Fetch related products
                    async function loadRelatedProducts() {
                        try {
                            const response = await fetch(`/api/products/${currentProductId}/related?limit=10`);

                            if (!response.ok) {
                                throw new Error('Failed to fetch related products');
                            }

                            const products = await response.json();

                            // Hide loading state
                            document.getElementById('loading-state').style.display = 'none';

                            if (products.length === 0) {
                                document.getElementById('related-products-container').innerHTML =
                                    '<div class="flex justify-center items-center w-full py-10 text-neutral-400">No related products found</div>';
                                return;
                            }

                            // Render products
                            renderRelatedProducts(products);

                            // Show pagination if needed
                            if (products.length > 5) {
                                setupPagination(products.length);
                            }

                        } catch (error) {
                            console.error('Error loading related products:', error);
                            document.getElementById('loading-state').innerHTML =
                                '<div class="text-red-500">Failed to load related products</div>';
                        }
                    }

                    // Render products
                    function renderRelatedProducts(products) {
                        const container = document.getElementById('related-products-container');

                        container.innerHTML = products.map(product => `
      <article class="flex flex-col justify-center items-start px-2.5 py-0 flex-[0_0_auto] max-w-[286px]">
        <div class="flex flex-col justify-center items-start self-stretch flex-[1_0_0]">
          <div class="flex flex-col gap-3 items-start self-stretch flex-[1_0_0]">
            <!-- Product Image -->
            <div class="flex flex-col items-start self-stretch">
              <a href="/products/${product.productId}" class="block w-full">
                <img
                  src="${product.mainImageUrl || 'https://via.placeholder.com/266'}"
                  alt="${product.productName}"
                  class="self-stretch h-[266px] max-w-[266px] object-cover"
                  onerror="this.src='https://via.placeholder.com/266?text=No+Image'"
                />
              </a>
            </div>

            <!-- Product Info -->
            <div class="flex flex-col gap-2 items-start self-stretch flex-[1_0_0]">
              <!-- Product Name -->
              <header class="flex justify-center items-center self-stretch max-h-[33.6px]">
                <div class="flex flex-col items-center max-h-[39.2px] w-[266px]">
                  <div class="flex justify-center items-start">
                    <h3 class="text-sm leading-5 text-center text-zinc-800 line-clamp-2">
                      <a href="/products/${product.productId}" class="hover:text-amber-500 transition-colors">
                        ${product.productName}
                      </a>
                    </h3>
                  </div>
                </div>
              </header>

              <!-- Category -->
              <div class="flex flex-col items-start self-stretch">
                <div class="flex flex-col items-center self-stretch">
                  <div class="flex justify-center items-start pb-px">
                    <p class="text-sm leading-5 text-center text-neutral-400">Category ${product.categoryId}</p>
                  </div>
                </div>
              </div>

              <!-- Price -->
              <div class="flex flex-col justify-end items-start self-stretch flex-[1_0_0] min-h-[18px]">
                <div class="flex flex-col items-center self-stretch">
                  <p class="self-stretch text-sm leading-5 text-center text-amber-500">
                    ${formatPrice(product)}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </article>
    `).join('');
                    }

                    // Format price display
                    function formatPrice(product) {
                        const formatVND = (price) => {
                            return new Intl.NumberFormat('vi-VN', {
                                style: 'currency',
                                currency: 'VND',
                                minimumFractionDigits: 0
                            }).format(price);
                        };

                        if (product.minPrice && product.maxPrice) {
                            if (product.minPrice === product.maxPrice) {
                                return formatVND(product.minPrice);
                            } else {
                                return `${formatVND(product.minPrice)} – ${formatVND(product.maxPrice)}`;
                            }
                        }

                        return 'Contact for price';
                    }

                    // Setup pagination (optional, for carousel functionality)
                    function setupPagination(totalProducts) {
                        const itemsPerPage = 5;
                        const totalPages = Math.ceil(totalProducts / itemsPerPage);

                        if (totalPages <= 1) return;

                        const paginationContainer = document.querySelector('#pagination-dots nav');
                        document.getElementById('pagination-dots').style.display = 'flex';

                        paginationContainer.innerHTML = Array.from({length: totalPages}, (_, i) => `
      <button
        class="w-2.5 h-2.5 rounded-xl border-2 border-solid ${i === 0 ? 'bg-zinc-800 border-zinc-800' : 'border-zinc-400'}"
        aria-label="Page ${i + 1}"
        ${i === 0 ? 'aria-current="page"' : ''}
        onclick="scrollToPage(${i})"
      ></button>
    `).join('');
                    }

                    // Scroll to specific page (optional carousel functionality)
                    function scrollToPage(pageIndex) {
                        const container = document.getElementById('related-products-container');
                        const itemWidth = 286; // width + gap
                        container.scrollTo({
                            left: pageIndex * itemWidth * 5,
                            behavior: 'smooth'
                        });

                        // Update pagination dots
                        const dots = document.querySelectorAll('#pagination-dots button');
                        dots.forEach((dot, index) => {
                            if (index === pageIndex) {
                                dot.classList.add('bg-zinc-800', 'border-zinc-800');
                                dot.classList.remove('border-zinc-400');
                                dot.setAttribute('aria-current', 'page');
                            } else {
                                dot.classList.remove('bg-zinc-800', 'border-zinc-800');
                                dot.classList.add('border-zinc-400');
                                dot.removeAttribute('aria-current');
                            }
                        });
                    }

                    // Load products when page loads
                    document.addEventListener('DOMContentLoaded', loadRelatedProducts);
                </script>

                <style>
                    /* Custom scrollbar for product carousel */
                    #related-products-container {
                        scrollbar-width: thin;
                        scrollbar-color: #d4d4d4 transparent;
                    }

                    #related-products-container::-webkit-scrollbar {
                        height: 6px;
                    }

                    #related-products-container::-webkit-scrollbar-track {
                        background: transparent;
                    }

                    #related-products-container::-webkit-scrollbar-thumb {
                        background-color: #d4d4d4;
                        border-radius: 3px;
                    }

                    #related-products-container::-webkit-scrollbar-thumb:hover {
                        background-color: #a3a3a3;
                    }

                    /* Line clamp for product names */
                    .line-clamp-2 {
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                    }
                </style>
            </section>
        </div>
    </div>
</main>

<footer class="py-5">
    <div class="container-fluid">
        <div class="row">

            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="footer-menu">
                    <img src="images/logo.png" alt="logo">
                    <div class="social-links mt-5">
                        <ul class="d-flex list-unstyled gap-2">
                            <li>
                                <a href="#" class="btn btn-outline-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M15.12 5.32H17V2.14A26.11 26.11 0 0 0 14.26 2c-2.72 0-4.58 1.66-4.58 4.7v2.62H6.61v3.56h3.07V22h3.68v-9.12h3.06l.46-3.56h-3.52V7.05c0-1.05.28-1.73 1.76-1.73Z"/>
                                    </svg>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn btn-outline-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M22.991 3.95a1 1 0 0 0-1.51-.86a7.48 7.48 0 0 1-1.874.794a5.152 5.152 0 0 0-3.374-1.242a5.232 5.232 0 0 0-5.223 5.063a11.032 11.032 0 0 1-6.814-3.924a1.012 1.012 0 0 0-.857-.365a.999.999 0 0 0-.785.5a5.276 5.276 0 0 0-.242 4.769l-.002.001a1.041 1.041 0 0 0-.496.89a3.042 3.042 0 0 0 .027.439a5.185 5.185 0 0 0 1.568 3.312a.998.998 0 0 0-.066.77a5.204 5.204 0 0 0 2.362 2.922a7.465 7.465 0 0 1-3.59.448A1 1 0 0 0 1.45 19.3a12.942 12.942 0 0 0 7.01 2.061a12.788 12.788 0 0 0 12.465-9.363a12.822 12.822 0 0 0 .535-3.646l-.001-.2a5.77 5.77 0 0 0 1.532-4.202Zm-3.306 3.212a.995.995 0 0 0-.234.702c.01.165.009.331.009.488a10.824 10.824 0 0 1-.454 3.08a10.685 10.685 0 0 1-10.546 7.93a10.938 10.938 0 0 1-2.55-.301a9.48 9.48 0 0 0 2.942-1.564a1 1 0 0 0-.602-1.786a3.208 3.208 0 0 1-2.214-.935q.224-.042.445-.105a1 1 0 0 0-.08-1.943a3.198 3.198 0 0 1-2.25-1.726a5.3 5.3 0 0 0 .545.046a1.02 1.02 0 0 0 .984-.696a1 1 0 0 0-.4-1.137a3.196 3.196 0 0 1-1.425-2.673c0-.066.002-.133.006-.198a13.014 13.014 0 0 0 8.21 3.48a1.02 1.02 0 0 0 .817-.36a1 1 0 0 0 .206-.867a3.157 3.157 0 0 1-.087-.729a3.23 3.23 0 0 1 3.226-3.226a3.184 3.184 0 0 1 2.345 1.02a.993.993 0 0 0 .921.298a9.27 9.27 0 0 0 1.212-.322a6.681 6.681 0 0 1-1.026 1.524Z"/>
                                    </svg>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn btn-outline-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M23 9.71a8.5 8.5 0 0 0-.91-4.13a2.92 2.92 0 0 0-1.72-1A78.36 78.36 0 0 0 12 4.27a78.45 78.45 0 0 0-8.34.3a2.87 2.87 0 0 0-1.46.74c-.9.83-1 2.25-1.1 3.45a48.29 48.29 0 0 0 0 6.48a9.55 9.55 0 0 0 .3 2a3.14 3.14 0 0 0 .71 1.36a2.86 2.86 0 0 0 1.49.78a45.18 45.18 0 0 0 6.5.33c3.5.05 6.57 0 10.2-.28a2.88 2.88 0 0 0 1.53-.78a2.49 2.49 0 0 0 .61-1a10.58 10.58 0 0 0 .52-3.4c.04-.56.04-3.94.04-4.54ZM9.74 14.85V8.66l5.92 3.11c-1.66.92-3.85 1.96-5.92 3.08Z"/>
                                    </svg>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn btn-outline-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M17.34 5.46a1.2 1.2 0 1 0 1.2 1.2a1.2 1.2 0 0 0-1.2-1.2Zm4.6 2.42a7.59 7.59 0 0 0-.46-2.43a4.94 4.94 0 0 0-1.16-1.77a4.7 4.7 0 0 0-1.77-1.15a7.3 7.3 0 0 0-2.43-.47C15.06 2 14.72 2 12 2s-3.06 0-4.12.06a7.3 7.3 0 0 0-2.43.47a4.78 4.78 0 0 0-1.77 1.15a4.7 4.7 0 0 0-1.15 1.77a7.3 7.3 0 0 0-.47 2.43C2 8.94 2 9.28 2 12s0 3.06.06 4.12a7.3 7.3 0 0 0 .47 2.43a4.7 4.7 0 0 0 1.15 1.77a4.78 4.78 0 0 0 1.77 1.15a7.3 7.3 0 0 0 2.43.47C8.94 22 9.28 22 12 22s3.06 0 4.12-.06a7.3 7.3 0 0 0 2.43-.47a4.7 4.7 0 0 0 1.77-1.15a4.85 4.85 0 0 0 1.16-1.77a7.59 7.59 0 0 0 .46-2.43c0-1.06.06-1.4.06-4.12s0-3.06-.06-4.12ZM20.14 16a5.61 5.61 0 0 1-.34 1.86a3.06 3.06 0 0 1-.75 1.15a3.19 3.19 0 0 1-1.15.75a5.61 5.61 0 0 1-1.86.34c-1 .05-1.37.06-4 .06s-3 0-4-.06a5.73 5.73 0 0 1-1.94-.3a3.27 3.27 0 0 1-1.1-.75a3 3 0 0 1-.74-1.15a5.54 5.54 0 0 1-.4-1.9c0-1-.06-1.37-.06-4s0-3 .06-4a5.54 5.54 0 0 1 .35-1.9A3 3 0 0 1 5 5a3.14 3.14 0 0 1 1.1-.8A5.73 5.73 0 0 1 8 3.86c1 0 1.37-.06 4-.06s3 0 4 .06a5.61 5.61 0 0 1 1.86.34a3.06 3.06 0 0 1 1.19.8a3.06 3.06 0 0 1 .75 1.1a5.61 5.61 0 0 1 .34 1.9c.05 1 .06 1.37.06 4s-.01 3-.06 4ZM12 6.87A5.13 5.13 0 1 0 17.14 12A5.12 5.12 0 0 0 12 6.87Zm0 8.46A3.33 3.33 0 1 1 15.33 12A3.33 3.33 0 0 1 12 15.33Z"/>
                                    </svg>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="btn btn-outline-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M1.04 17.52q.1-.16.32-.02a21.308 21.308 0 0 0 10.88 2.9a21.524 21.524 0 0 0 7.74-1.46q.1-.04.29-.12t.27-.12a.356.356 0 0 1 .47.12q.17.24-.11.44q-.36.26-.92.6a14.99 14.99 0 0 1-3.84 1.58A16.175 16.175 0 0 1 12 22a16.017 16.017 0 0 1-5.9-1.09a16.246 16.246 0 0 1-4.98-3.07a.273.273 0 0 1-.12-.2a.215.215 0 0 1 .04-.12Zm6.02-5.7a4.036 4.036 0 0 1 .68-2.36A4.197 4.197 0 0 1 9.6 7.98a10.063 10.063 0 0 1 2.66-.66q.54-.06 1.76-.16v-.34a3.562 3.562 0 0 0-.28-1.72a1.5 1.5 0 0 0-1.32-.6h-.16a2.189 2.189 0 0 0-1.14.42a1.64 1.64 0 0 0-.62 1a.508.508 0 0 1-.4.46L7.8 6.1q-.34-.08-.34-.36a.587.587 0 0 1 .02-.14a3.834 3.834 0 0 1 1.67-2.64A6.268 6.268 0 0 1 12.26 2h.5a5.054 5.054 0 0 1 3.56 1.18a3.81 3.81 0 0 1 .37.43a3.875 3.875 0 0 1 .27.41a2.098 2.098 0 0 1 .18.52q.08.34.12.47a2.856 2.856 0 0 1 .06.56q.02.43.02.51v4.84a2.868 2.868 0 0 0 .15.95a2.475 2.475 0 0 0 .29.62q.14.19.46.61a.599.599 0 0 1 .12.32a.346.346 0 0 1-.16.28q-1.66 1.44-1.8 1.56a.557.557 0 0 1-.58.04q-.28-.24-.49-.46t-.3-.32a4.466 4.466 0 0 1-.29-.39q-.2-.29-.28-.39a4.91 4.91 0 0 1-2.2 1.52a6.038 6.038 0 0 1-1.68.2a3.505 3.505 0 0 1-2.53-.95a3.553 3.553 0 0 1-.99-2.69Zm3.44-.4a1.895 1.895 0 0 0 .39 1.25a1.294 1.294 0 0 0 1.05.47a1.022 1.022 0 0 0 .17-.02a1.022 1.022 0 0 1 .15-.02a2.033 2.033 0 0 0 1.3-1.08a3.13 3.13 0 0 0 .33-.83a3.8 3.8 0 0 0 .12-.73q.01-.28.01-.92v-.5a7.287 7.287 0 0 0-1.76.16a2.144 2.144 0 0 0-1.76 2.22Zm8.4 6.44a.626.626 0 0 1 .12-.16a3.14 3.14 0 0 1 .96-.46a6.52 6.52 0 0 1 1.48-.22a1.195 1.195 0 0 1 .38.02q.9.08 1.08.3a.655.655 0 0 1 .08.36v.14a4.56 4.56 0 0 1-.38 1.65a3.84 3.84 0 0 1-1.06 1.53a.302.302 0 0 1-.18.08a.177.177 0 0 1-.08-.02q-.12-.06-.06-.22a7.632 7.632 0 0 0 .74-2.42a.513.513 0 0 0-.08-.32q-.2-.24-1.12-.24q-.34 0-.8.04q-.5.06-.92.12a.232.232 0 0 1-.16-.04a.065.065 0 0 1-.02-.08a.153.153 0 0 1 .02-.06Z"/>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-2 col-sm-6">
                <div class="footer-menu">
                    <h5 class="widget-title">Ultras</h5>
                    <ul class="menu-list list-unstyled">
                        <li class="menu-item">
                            <a href="#" class="nav-link">About us</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Conditions </a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Our Journals</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Careers</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Affiliate Programme</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Ultras Press</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="footer-menu">
                    <h5 class="widget-title">Customer Service</h5>
                    <ul class="menu-list list-unstyled">
                        <li class="menu-item">
                            <a href="#" class="nav-link">FAQ</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Contact</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Privacy Policy</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Returns & Refunds</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Cookie Guidelines</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Delivery Information</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-2 col-sm-6">
                <div class="footer-menu">
                    <h5 class="widget-title">Customer Service</h5>
                    <ul class="menu-list list-unstyled">
                        <li class="menu-item">
                            <a href="#" class="nav-link">FAQ</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Contact</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Privacy Policy</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Returns & Refunds</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Cookie Guidelines</a>
                        </li>
                        <li class="menu-item">
                            <a href="#" class="nav-link">Delivery Information</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="footer-menu">
                    <h5 class="widget-title">Subscribe Us</h5>
                    <p>Subscribe to our newsletter to get updates about our grand offers.</p>
                    <form class="d-flex mt-3 gap-0" role="newsletter">
                        <input class="form-control rounded-start rounded-0 bg-light" type="email"
                               placeholder="Email Address" aria-label="Email Address">
                        <button class="btn btn-dark rounded-end rounded-0" type="submit">Subscribe</button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</footer>
<div id="footer-bottom">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6 copyright">
                <p>© 2023 Foodmart. All rights reserved.</p>
            </div>
            <div class="col-md-6 credit-link text-start text-md-end">
                <p>Free HTML Template by <a href="https://templatesjungle.com/">TemplatesJungle</a> Distributed by <a
                        href="https://themewagon">ThemeWagon</a></p>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{header :: scripts}"></th:block>


<!-- JavaScript -->

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const desc = document.getElementById("auto-format-description");
        if (!desc) return;

        // Danh sách icon cần xử lý (có thể mở rộng)
        const icons = ['☕', '✅', '⚠️', '🗣', '📊', '🛠', '💧', '🧪'];

        let html = desc.innerHTML;

        icons.forEach(icon => {
            // Tạo regex: icon + bất kỳ khoảng trắng nào sau nó + nội dung đến < hoặc xuống dòng
            // Nhưng chỉ áp dụng khi icon ở đầu dòng (sau <br>, <div>, hoặc đầu chuỗi)
            const regex = new RegExp(`(^|\\s)(>${icon}|<br\\s*\\/?>${icon}|\\n${icon}|>${icon.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi');

            // Thay thế bằng: <br> + <strong>icon</strong> + nội dung
            html = html.replace(
                new RegExp(`(${icon})\\s*([^<>\\n]+)`, 'gi'),
                `<br><strong class="text-zinc-800">${icon}</strong> $2`
            );
        });

        // Loại bỏ <br> đầu tiên nếu có
        if (html.startsWith('<br>')) {
            html = html.replace(/^<br>/, '');
        }

        // Gán lại nội dung đã xử lý
        desc.innerHTML = html;

        // Tùy chọn: Thêm class cho các đoạn có icon để style riêng
        desc.querySelectorAll('br').forEach(br => {
            const next = br.nextSibling;
            if (next && next.nodeType === 3) { // text node
                const span = document.createElement('span');
                span.className = 'block mt-4';
                span.innerHTML = '<strong class="text-zinc-800">' + next.textContent.trim().charAt(0) + '</strong>' + next.textContent.trim().slice(1);
                br.parentNode.replaceChild(span, next);
                br.remove();
            }
        });
    });
</script>
<script th:inline="javascript">
    /**
     * Product Page - Add to Cart Implementation
     * Thêm vào cuối file product-page.html, thay thế function addToCart() hiện tại
     */

// Lấy thông tin product từ Thymeleaf
    const productId = /*[[${product.productId}]]*/ 0;
    const sizes = /*[[${product.sizes}]]*/ [];

    /**
     * Tăng số lượng
     */
    function increaseQuantity() {
        const qty = document.getElementById('quantity');
        const currentQty = parseInt(qty.value);
        const maxQty = parseInt(qty.max) || 999;

        if (currentQty < maxQty) {
            qty.value = currentQty + 1;
        }
    }

    /**
     * Giảm số lượng
     */
    function decreaseQuantity() {
        const qty = document.getElementById('quantity');
        const currentQty = parseInt(qty.value);

        if (currentQty > 1) {
            qty.value = currentQty - 1;
        }
    }

    /**
     * Thay đổi size - cập nhật giá và SKU
     */
    function changeSize(select) {
        const selected = select.options[select.selectedIndex];

        if (!selected.value) {
            return;
        }

        const sku = selected.getAttribute('data-sku');
        const effective = parseFloat(selected.getAttribute('data-effective'));
        const regular = parseFloat(selected.getAttribute('data-regular'));
        const promotion = selected.getAttribute('data-promotion') === 'true';
        const discount = selected.getAttribute('data-discount');

        // Cập nhật SKU
        document.getElementById('product-sku').textContent = sku;

        // Cập nhật giá
        const priceContainer = document.querySelector('.text-amber-500');

        if (promotion && regular > effective) {
            priceContainer.innerHTML = `
            <span class="font-bold">${formatPrice(effective)}</span>
            <span class="mx-1">—</span>
            <span class="font-bold line-through text-neutral-400">${formatPrice(regular)}</span>
            ${discount > 0 ? `<span class="badge bg-danger ms-2">-${discount}%</span>` : ''}
        `;
        } else {
            priceContainer.innerHTML = `<span class="font-bold">${formatPrice(effective)}</span>`;
        }
    }

    /**
     * Format giá tiền
     */
    function formatPrice(price) {
        return new Intl.NumberFormat('vi-VN', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).format(price) + ' RM';
    }

    /**
     * Thêm vào giỏ hàng
     */
    async function addToCart() {
        try {
            // Lấy thông tin từ form
            const sizeSelect = document.getElementById('sizeSelect');
            console.log("Select element:", sizeSelect);
            console.log("Selected value:", sizeSelect ? sizeSelect.value : '(no select)');
            console.log("Options:", sizeSelect ? [...sizeSelect.options].map(o => o.value) : []);
            const priceId = sizeSelect ? sizeSelect.value : '';
            const quantity = parseInt(document.getElementById('quantity').value) || 1;

            // Validate
            if (!priceId) {
                showNotification('Vui lòng chọn size sản phẩm', 'warning');
                if (sizeSelect) sizeSelect.focus();
                return;
            }

            if (quantity < 1) {
                showNotification('Số lượng phải lớn hơn 0', 'warning');
                return;
            }

            // Lấy thông tin size đã chọn
            const selectedOption = sizeSelect.options[sizeSelect.selectedIndex];
            const sizeSelected = selectedOption ? selectedOption.text : '';

            // Disable button để tránh click nhiều lần
            const addButton = document.querySelector('button[onclick="addToCart()"]');
            if (addButton) {
                addButton.disabled = true;
                addButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ĐANG THÊM...';
            }

            // Chuẩn bị data theo đúng cấu trúc AddToCartRequest
            const cartData = {
                productId: productId,
                quantity: quantity,
                sizeSelected: sizeSelected,
                priceId: parseInt(priceId)
            };

            console.log('Adding to cart:', cartData);

            // Gọi API thêm vào giỏ
            const response = await fetch('/api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(cartData)
            });

            // Kiểm tra response
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Server error:', errorText);
                throw new Error(`Server error: ${response.status}`);
            }

            const result = await response.json();
            console.log('Cart response:', result);

            if (!result.success) {
                throw new Error(result.message || 'Không thể thêm vào giỏ hàng');
            }

            // Hiển thị thông báo thành công
            showNotification(result.message || 'Đã thêm vào giỏ hàng!', 'success');

            // Tải lại thông tin giỏ hàng để cập nhật UI
            // await fetchAndUpdateCart();

            // Mở offcanvas giỏ hàng (nếu có)
            const offcanvasElement = document.getElementById('offcanvasCart');
            if (offcanvasElement && typeof bootstrap !== 'undefined') {
                const offcanvas = new bootstrap.Offcanvas(offcanvasElement);
                offcanvas.show();
            }

            // Reset quantity về 1 (tùy chọn)
            document.getElementById('quantity').value = 1;

        } catch (error) {
            console.error('Error adding to cart:', error);
            showNotification(error.message || 'Có lỗi xảy ra, vui lòng thử lại', 'error');
        } finally {
            // Re-enable button
            const addButton = document.querySelector('button[onclick="addToCart()"]');
            if (addButton) {
                addButton.disabled = false;
                addButton.innerHTML = '<span class="text-sm font-bold leading-4 text-center text-white uppercase">Add to cart</span>';
            }
        }
    }

    /**
     * Cập nhật header cart (tổng tiền và số lượng)
     */
    function updateHeaderCart(cart) {
        // Cập nhật tổng tiền
        const cartTotal = document.querySelector('.cart-total');
        if (cartTotal && cart.totalAmount) {
            cartTotal.textContent = formatCurrency(cart.totalAmount);
        }

        // Cập nhật badge số lượng
        const badges = document.querySelectorAll('.badge.bg-primary.rounded-pill');
        badges.forEach(badge => {
            if (cart.totalItems > 0) {
                badge.textContent = cart.totalItems;
                badge.style.display = 'inline-block';
            } else {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
        });
    }

    /**
     * Format tiền tệ VND
     */
    function formatCurrency(amount) {
        if (!amount) return '0₫';
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount);
    }

    /**
     * Hiển thị thông báo
     */
    function showNotification(message, type = 'success') {
        // Xóa các toast cũ
        const oldToasts = document.querySelectorAll('.toast');
        oldToasts.forEach(toast => toast.remove());

        // Tạo toast mới
        const bgClass = type === 'success' ? 'bg-success' :
            type === 'warning' ? 'bg-warning' :
                type === 'error' ? 'bg-danger' : 'bg-info';

        const toastHTML = `
        <div class="toast align-items-center text-white ${bgClass} border-0 position-fixed top-0 end-0 m-3"
             role="alert" aria-live="assertive" aria-atomic="true"
             style="z-index: 9999;">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                        data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    `;

        // Thêm vào body
        const toastElement = document.createElement('div');
        toastElement.innerHTML = toastHTML;
        document.body.appendChild(toastElement.firstElementChild);

        // Hiển thị toast
        const toast = new bootstrap.Toast(document.querySelector('.toast'), {
            delay: 3000
        });
        toast.show();

        // Xóa element sau khi ẩn
        document.querySelector('.toast').addEventListener('hidden.bs.toast', function () {
            this.remove();
        });
    }

    /**
     * Thêm vào wishlist
     */
    function addToWishlist() {
        // TODO: Implement wishlist functionality
        console.log('Add to wishlist:', productId);
        showNotification('Tính năng wishlist đang được phát triển', 'info');
    }

    /**
     * Tab switching
     */
    function showTab(tab) {
        // Ẩn tất cả tab content
        document.querySelectorAll('.tab-content').forEach(el => {
            el.classList.add('hidden');
        });

        // Remove active từ tất cả buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            const activeBar = btn.querySelector('.active-bar');
            if (activeBar) activeBar.remove();
        });

        // Hiển thị tab được chọn
        const tabPanel = document.getElementById(tab + '-panel');
        if (tabPanel) {
            tabPanel.classList.remove('hidden');
        }

        // Active button được chọn
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => {
            const onclick = btn.getAttribute('onclick');
            if (onclick && onclick.includes(tab)) {
                btn.classList.add('active');
                const bar = document.createElement('div');
                bar.className = 'active-bar absolute bg-amber-500 bottom-[-30px] h-[3px] w-[106px]';
                btn.appendChild(bar);
            }
        });
    }

    /**
     * Khởi tạo khi trang load
     */
    // document.addEventListener('DOMContentLoaded', function () {
    //     console.log('Product page loaded. Product ID:', productId);
    //
    //     // Set max quantity từ stock
    //     const stockQuantity = /*[[${product.stockQuantity}]]*/ 999;
    //     const qtyInput = document.getElementById('quantity');
    //     if (qtyInput) {
    //         qtyInput.max = stockQuantity;
    //     }
    //
    //     // Tự động chọn size đầu tiên nếu chỉ có 1 size
    //     const sizeSelect = document.querySelector('select');
    //     if (sizeSelect && sizes.length === 1) {
    //         sizeSelect.selectedIndex = 1; // Index 0 là "Choose an option"
    //         changeSize(sizeSelect);
    //     }
    // });
</script>
</body>
</html>